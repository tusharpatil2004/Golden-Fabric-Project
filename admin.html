
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fabric Shop - Viscose</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* Custom scrollbar for cart panel */
  #cartPanel::-webkit-scrollbar {
    width: 6px;
  }
  #cartPanel::-webkit-scrollbar-thumb {
    background-color: #888;
    border-radius: 3px;
  }
  #cartPanel::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
  .sidenav {
  height: 100%;
  width: 0;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  transition: 0.5s;
  padding-top: 60px;
}

.sidenav a {
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 25px;
  color: #818181;
  display: block;
  transition: 0.3s;
  padding-top: -25px;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
  font-family: 'poppins';
}
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

  <!-- Header -->
  <header class="flex items-center justify-between p-4 bg-gray-800 sticky top-0 z-20">
    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <a href="home.html" class="fas fa-home"> Home</a><br>
      <a href="aboutus.html" class="fas fa-user"> About Us</a><br>
      <a href="contactus.html" class="fas fa-phone"> Contact Us</a>
    </div>
    <span aria-label="Menu" class="text-white text-3xl" style="font-size:30px;cursor:pointer;margin-left:15px;" onclick="openNav()">&#9776;</span>
    <div class="font-bold text-xl tracking-wide">GOLDEN FABRICS</div>
    
    <!-- Cart Icon with count -->
    <div class="relative cursor-pointer" id="cartIcon" title="View Cart">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" 
              stroke-linejoin="round" 
              d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2 6m5-6v6m4-6v6m5-12h-6" />
      </svg>
      <span id="cartCount" class="absolute -top-1 -right-1 bg-red-600 rounded-full text-xs w-5 h-5 flex items-center justify-center font-semibold">0</span>
    </div>
  </header>

  <br><br>
    <div class="flex justify-between mb-6">
        <h2 style="margin-left: 660px; font-size: 30px;">All Orders</h2>
        <div class="flex space-x-6" style="margin-right: 150px;">
            <button onclick="adminLogout()" class="bg-red-600 text-white px-4 py-2 rounded">
                Logout
            </button>
            <button id="refreshBtn" class="bg-blue-600 text-white px-4 py-2 rounded">
                Refresh
            </button>
        </div>
    </div>
            
            <div class="overflow-x-auto">
                <table style="text-align: center; width: 80%; background-color: #555 ; margin-left: auto; margin-right: auto;">
                    <thead>
                        <tr class="bg-gray-200 text-gray-700 text-align-center">
                            <th class="py-3 px-4 ">Order ID</th>
                            <th class="py-3 px-4 ">Customer</th>
                            <th class="py-3 px-4 ">Date</th>
                            <th class="py-3 px-4 ">Total</th>
                            <th class="py-3 px-4 ">Status</th>
                            <th class="py-3 px-4 ">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody" class="text-gray-700">
                        <!-- Orders will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Cart Panel (initially hidden) -->
  <aside id="cartPanel" 
         class="fixed top-16 right-4 w-90 max-h-100 bg-gray-800 border border-yellow-400 rounded-lg shadow-lg overflow-auto p-4 hidden z-30">
    <h2 class="text-yellow-400 text-lg font-bold mb-4">Your Cart</h2>
    <div id="cartItems" class="flex flex-col gap-4 max-h-72 overflow-auto"></div>
    <p id="emptyCartMsg" class="text-gray-400 text-center">Your cart is empty.</p>
    <br>
    <a href="place-order.html" class="text-yellow-400 text-lg font-bold mb-4" style="margin-left: 95px;">Place Order</a>
  </aside>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Elements references
    const addToCartBtn = document.getElementById('addToCartBtn');
    const cartPanel = document.getElementById('cartPanel');
    const cartIcon = document.getElementById('cartIcon');
    const cartItemsContainer = document.getElementById('cartItems');
    const cartCount = document.getElementById('cartCount');
    const emptyCartMsg = document.getElementById('emptyCartMsg');
    const quantityInput = document.getElementById('quantityInput');
    const fabricName = 'Viscose';
    const fabricImage = 'images/viscose.jpg';
    const fabricPrice = 2000; // Store as a number for calculations

    // Cart data array
    let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];

    // Function to render cart items inside cartPanel
    function renderCart() {
        // Clear current items
        cartItemsContainer.innerHTML = '';
        let subtotal = 0; // Total for all items
        
        if (cartItems.length === 0) {
            emptyCartMsg.style.display = 'block';
        } else {
            emptyCartMsg.style.display = 'none';
            cartItems.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('flex', 'items-center', 'gap-3');

                // Image Thumbnail
                const img = document.createElement('img');
                img.src = item.image;
                img.alt = item.name + ' image';
                img.classList.add('w-12', 'h-12', 'object-cover', 'rounded');

                // Name span
                const name = document.createElement('span');
                name.textContent = item.name;
                name.classList.add('flex-grow', 'text-white', 'font-semibold');

                // Quantity span
                const quantity = document.createElement('span');
                quantity.textContent ='Qty. '+ item.quantity;
                quantity.classList.add('flex-grow', 'text-white', 'font-semibold');

                // Subtotal calculation
                const itemSubtotal = item.quantity * fabricPrice;
                subtotal += itemSubtotal;

                // Price span
                const price = document.createElement('span');
                price.textContent = 'Rs. ' + itemSubtotal;
                price.classList.add('flex-grow', 'text-white', 'font-semibold');

                // Remove button
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'Ã—';
                removeBtn.title = 'Remove from cart';
                removeBtn.classList.add('text-red-500', 'text-xl', 'font-bold', 'hover:text-red-700');
                removeBtn.onclick = () => { removeFromCart(index); };

                itemDiv.appendChild(img);
                itemDiv.appendChild(name);
                itemDiv.appendChild(quantity);
                itemDiv.appendChild(price);
                itemDiv.appendChild(removeBtn);
                cartItemsContainer.appendChild(itemDiv);
            });
        }

        // Update cart count badge
        cartCount.textContent = cartItems.length;

        // Update subtotal in the cart
        const subtotalElem = document.createElement('div');
        subtotalElem.textContent = 'Subtotal: Rs. ' + subtotal;
        subtotalElem.classList.add('text-yellow-400', 'font-bold');
        cartItemsContainer.appendChild(subtotalElem);
    }

    // Function to add item to cart
    function addToCart() {
        const quantity = parseInt(quantityInput.value, 10);
        // Check if quantity is valid
        if (isNaN(quantity) || quantity < 1) {
            alert('Minimum order quantity is 10 meters.');
            return;
        }

        // Check if already in cart - avoid duplicates
        const existingIndex = cartItems.findIndex(item => item.name === fabricName);
        if (existingIndex !== -1) {
            alert(fabricName + ' is already in your cart.');
            return;
        }

        cartItems.push({ name: fabricName, image: fabricImage, quantity: quantity });
        localStorage.setItem('cartItems', JSON.stringify(cartItems)); // Save to local storage
        renderCart();
        alert(fabricName + ' added to cart!');
    }

    // Function to remove item from cart by index
    function removeFromCart(index) {
        cartItems.splice(index, 1);
        localStorage.setItem('cartItems', JSON.stringify(cartItems)); // Update local storage
        renderCart();
    }

    // Toggle cart panel visibility on cart icon click
    cartIcon.addEventListener('click', () => {
        cartPanel.classList.toggle('hidden');
    });

    // Initial cart render
    renderCart();

    // Add event listener to button
    addToCartBtn.addEventListener('click', addToCart);
});

</script>
<script>
    function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }
</script>

    <script>
        async function loadOrders() {
    try {
        const response = await fetch('http://localhost:5000/api/admin/orders', {
            headers: {
                'Authorization': 'Bearer admin123'
            }
        });
        // ... rest of the function
    }
        }

function viewOrderDetails(orderId) {
    fetch(`http://localhost:5000/api/admin/orders/${orderId}`, {
        headers: {
            'Authorization': 'Bearer admin123'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show order details in a modal
            showOrderModal(data.order);
        }
    });
}

function showOrderModal(order) {
    // Create a modal with order details
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full max-h-screen overflow-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Order #${order.id}</h3>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                        class="text-gray-500 hover:text-gray-700">
                    &times;
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h4 class="font-semibold mb-2">Customer Details</h4>
                    <p><span class="font-medium">Name:</span> ${order.name}</p>
                    <p><span class="font-medium">Email:</span> ${order.email}</p>
                    <p><span class="font-medium">Phone:</span> ${order.mobile}</p>
                    <p><span class="font-medium">Address:</span> ${order.address}</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Order Details</h4>
                    <p><span class="font-medium">Date:</span> ${new Date(order.date).toLocaleString()}</p>
                    <p><span class="font-medium">Payment:</span> ${order.paymentMethod}</p>
                    <p><span class="font-medium">Status:</span> 
                        <select id="statusSelect" class="border rounded p-1">
                            <option ${order.status === 'Received' ? 'selected' : ''}>Received</option>
                            <option ${order.status === 'Processing' ? 'selected' : ''}>Processing</option>
                            <option ${order.status === 'Completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </p>
                </div>
            </div>
            <div class="mt-4">
                <h4 class="font-semibold mb-2">Items</h4>
                <ul class="list-disc pl-5">
                    ${order.items.map(item => 
                        `<li>${item.name} - Qty: ${item.quantity} - Rs. ${item.quantity * 2000}</li>`
                    ).join('')}
                </ul>
            </div>
            <div class="mt-4 grid grid-cols-3 gap-2">
                <div class="col-span-2">
                    <p><span class="font-medium">Subtotal:</span> Rs. ${order.subtotal}</p>
                    <p><span class="font-medium">Tax (10%):</span> Rs. ${order.tax}</p>
                    <p class="font-bold"><span class="font-medium">Total:</span> Rs. ${order.total}</p>
                </div>
                ${order.screenshot ? `
                <div>
                    <p class="font-medium">Payment Screenshot:</p>
                    <img src="/uploads/${order.screenshot}" alt="Payment proof" class="mt-2 max-w-full h-auto">
                </div>
                ` : ''}
            </div>
            <div class="mt-6 flex justify-end space-x-2">
                <button onclick="updateOrderStatus('${order.id}')" 
                        class="bg-blue-600 text-white px-4 py-2 rounded">
                    Update Status
                </button>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                        class="bg-gray-600 text-white px-4 py-2 rounded">
                    Close
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function updateOrderStatus(orderId) {
    const newStatus = document.getElementById('statusSelect').value;
    // In a real app, this would call your API to update the status
    const order = orders.find(o => o.id === orderId);
    if (order) {
        order.status = newStatus;
        alert('Status updated successfully');
        loadOrders();
    }
}



    // Check admin login status
    if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
        window.location.href = 'admin.html';
    }
    
    // Logout functionality
    function adminLogout() {
        sessionStorage.removeItem('adminLoggedIn');
        window.location.href = 'admin.html';
    
    
}

    </script>
</body>
</html>